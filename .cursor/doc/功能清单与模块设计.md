# åŠŸèƒ½æ¸…å•ä¸æ¨¡å—è®¾è®¡è¯¦ç»†æ–‡æ¡£

## ğŸ“‹ å®Œæ•´åŠŸèƒ½æ¸…å•

### 1. æ¨¡å‹ç®¡ç†åŠŸèƒ½ (Model Management)

#### 1.1 æ¨¡å‹åŠ è½½

| åŠŸèƒ½ç‚¹ | æ”¯æŒæ ¼å¼ | å…³é”®æŠ€æœ¯ | Composable | Store |
| --- | --- | --- | --- | --- |
| å•æ¨¡å‹åŠ è½½ | GLB, GLTF, FBX, OBJ, STL | GLTFLoader, DRACOLoader | `useModelLoader` | `sceneStore` |
| å¤šæ¨¡å‹åŠ è½½ | åŒä¸Š | æ‹–æ‹½ + Raycaster | `useMultiModelLoader` | `multiModelStore` |
| å¤–éƒ¨æ¨¡å‹ä¸Šä¼  | åŒä¸Š | FileReader, URL.createObjectURL | `useModelUpload` | `sceneStore` |
| æ¨¡å‹è¿›åº¦æ¡ | - | LoadingManager | `useLoadingProgress` | `editorStore` |
| æ¨¡å‹ç¼“å­˜ | - | IndexedDB | `useModelCache` | - |

#### 1.2 æ¨¡å‹æ“ä½œ

| åŠŸèƒ½ç‚¹   | æè¿°                  | Composable         | APIæ–¹æ³•          |
| -------- | --------------------- | ------------------ | ---------------- |
| æ¨¡å‹åˆ‡æ¢ | åœ¨å•/å¤šæ¨¡å‹æ¨¡å¼é—´åˆ‡æ¢ | `useModelSwitcher` | `switchModel()`  |
| æ¨¡å‹é€‰æ‹© | ç‚¹å‡»é€‰æ‹©æ¨¡å‹/æè´¨     | `useSelection`     | `selectObject()` |
| æ¨¡å‹åˆ é™¤ | åˆ é™¤åœºæ™¯ä¸­çš„æ¨¡å‹      | `useModelManager`  | `deleteModel()`  |
| æ¨¡å‹å¤åˆ¶ | å…‹éš†æ¨¡å‹åˆ°åœºæ™¯        | `useModelCloner`   | `cloneModel()`   |
| æ¨¡å‹å¯¼å‡º | å¯¼å‡ºä¸ºGLB/GLTF/USDZ   | `useModelExporter` | `exportModel()`  |

### 2. æ‹–æ‹½ç³»ç»ŸåŠŸèƒ½ (Drag & Drop System)

#### 2.1 æ‹–æ‹½ç±»å‹çŸ©é˜µ

```mermaid
graph TB
    A[æ‹–æ‹½ç³»ç»Ÿ]

    A --> B1[æ¨¡å‹æ‹–æ‹½]
    A --> B2[å‡ ä½•ä½“æ‹–æ‹½]
    A --> B3[æ ‡ç­¾æ‹–æ‹½]
    A --> B4[ç€è‰²å™¨æ‹–æ‹½]
    A --> B5[æ¨¡å‹åº“æ‹–æ‹½]

    B1 --> C1[è§¦å‘æ¡ä»¶:å¤šæ¨¡å‹æ¨¡å¼]
    B1 --> C2[æ‹–æ‹½æº:æ¨¡å‹åˆ—è¡¨]
    B1 --> C3[æ”¾ç½®ç›®æ ‡:3Dåœºæ™¯]
    B1 --> C4[ä½ç½®è®¡ç®—:Raycaster]
    B1 --> C5[ç»“æœ:æ·»åŠ åˆ°åœºæ™¯]

    B2 --> D1[è§¦å‘æ¡ä»¶:å‡ ä½•ä½“æ¨¡å¼]
    B2 --> D2[æ‹–æ‹½æº:å‡ ä½•ä½“åˆ—è¡¨]
    B2 --> D3[æ”¾ç½®ç›®æ ‡:3Dåœºæ™¯]
    B2 --> D4[ä½ç½®è®¡ç®—:Raycaster]
    B2 --> D5[ç»“æœ:åˆ›å»ºå‡ ä½•ä½“]

    B3 --> E1[è§¦å‘æ¡ä»¶:æ ‡ç­¾æ¨¡å¼]
    B3 --> E2[æ‹–æ‹½æº:æ ‡ç­¾å›¾æ ‡]
    B3 --> E3[æ”¾ç½®ç›®æ ‡:3Dåœºæ™¯]
    B3 --> E4[ä½ç½®è®¡ç®—:Raycaster]
    B3 --> E5[ç»“æœ:åˆ›å»ºCSS3Dæ ‡ç­¾]

    B4 --> F1[è§¦å‘æ¡ä»¶:ç€è‰²å™¨æ¨¡å¼]
    B4 --> F2[æ‹–æ‹½æº:ç€è‰²å™¨åˆ—è¡¨]
    B4 --> F3[æ”¾ç½®ç›®æ ‡:3Dåœºæ™¯]
    B4 --> F4[ä½ç½®è®¡ç®—:Raycaster]
    B4 --> F5[ç»“æœ:åˆ›å»ºç€è‰²å™¨ç½‘æ ¼]

    B5 --> G1[è§¦å‘æ¡ä»¶:æ¨¡å‹åº“é¡µé¢]
    B5 --> G2[æ‹–æ‹½æº:æ¨¡å‹å¡ç‰‡]
    B5 --> G3[æ”¾ç½®ç›®æ ‡:å¸ƒå±€å®¹å™¨]
    B5 --> G4[ä½ç½®è®¡ç®—:å®¹å™¨åæ ‡]
    B5 --> G5[ç»“æœ:è°ƒæ•´å¸ƒå±€]
```

#### 2.2 æ‹–æ‹½å®Œæ•´API

| Composable | æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
| --- | --- | --- | --- | --- |
| `useDragCore` | `startDrag` | (item, type, event) | void | å¼€å§‹æ‹–æ‹½ |
|  | `onDrag` | (event) | void | æ‹–æ‹½ä¸­ |
|  | `endDrag` | (event) | void | æ‹–æ‹½ç»“æŸ |
|  | `onDrop` | (event) | void | æ”¾ç½® |
| `useModelDrag` | `startModelDrag` | (model, event) | void | å¼€å§‹æ‹–æ‹½æ¨¡å‹ |
|  | `handleModelDrop` | (model, position) | Promise\<void\> | å¤„ç†æ¨¡å‹æ”¾ç½® |
| `useGeometryDrag` | `startGeometryDrag` | (geometry, event) | void | å¼€å§‹æ‹–æ‹½å‡ ä½•ä½“ |
|  | `createGeometry` | (type, params) | THREE.Mesh | åˆ›å»ºå‡ ä½•ä½“ |
| `useTagDrag` | `startTagDrag` | (tag, event) | void | å¼€å§‹æ‹–æ‹½æ ‡ç­¾ |
|  | `createTag` | (tag, position) | CSS3DObject | åˆ›å»º3Dæ ‡ç­¾ |

### 3. æè´¨ç³»ç»ŸåŠŸèƒ½

#### 3.1 æè´¨ç±»å‹æ”¯æŒ

```mermaid
graph LR
    A[æè´¨ç³»ç»Ÿ] --> B[åŸºç¡€æè´¨]
    A --> C[Lambertæè´¨]
    A --> D[Phongæè´¨]
    A --> E[Standardæè´¨]
    A --> F[Physicalæè´¨]
    A --> G[Toonæè´¨]
    A --> H[Matcapæè´¨]
    A --> I[é»˜è®¤æè´¨]

    B & C & D & E & F & G & H & I --> J[é€šç”¨å±æ€§]

    J --> K[é¢œè‰² color]
    J --> L[é€æ˜åº¦ opacity]
    J --> M[çº¿æ¡† wireframe]
    J --> N[æ·±åº¦å†™å…¥ depthWrite]
    J --> O[åŒé¢ side]

    J --> P[è´´å›¾ç³»ç»Ÿ]
    P --> P1[map åŸºç¡€è´´å›¾]
    P --> P2[normalMap æ³•çº¿è´´å›¾]
    P --> P3[roughnessMap ç²—ç³™åº¦è´´å›¾]
    P --> P4[metalnessMap é‡‘å±åº¦è´´å›¾]
```

#### 3.2 æè´¨åŠŸèƒ½API

```typescript
// æè´¨ç¼–è¾‘å™¨å®Œæ•´API
interface MaterialEditorAPI {
  // åŸºç¡€æ“ä½œ
  selectMaterial(material: Material): void;
  deselectMaterial(): void;

  // å±æ€§ç¼–è¾‘
  updateColor(color: number): void;
  updateOpacity(opacity: number): void;
  updateWireframe(enabled: boolean): void;
  updateDepthWrite(enabled: boolean): void;

  // ç±»å‹åˆ‡æ¢
  changeMaterialType(type: MaterialType): void;

  // è´´å›¾ç®¡ç†
  loadTexture(url: string, type: TextureType): Promise<void>;
  removeTexture(type: TextureType): void;

  // æ‰¹é‡æ“ä½œ
  applyToAll(config: Partial<MaterialConfig>): void;
  resetAll(): void;

  // çŠ¶æ€æŸ¥è¯¢
  getMaterialList(): Material[];
  getSelectedMaterial(): Material | null;
  getMaterialConfig(): MaterialConfig;
}
```

### 4. ç¯å…‰ç³»ç»ŸåŠŸèƒ½

#### 4.1 ç¯å…‰ç±»å‹å®Œæ•´é…ç½®

| ç¯å…‰ç±»å‹   | å±æ€§       | é»˜è®¤å€¼               | èŒƒå›´   | è¯´æ˜     |
| ---------- | ---------- | -------------------- | ------ | -------- |
| **ç¯å¢ƒå…‰** | color      | #ffffff              | -      | é¢œè‰²     |
|            | intensity  | 0.8                  | 0-5    | å¼ºåº¦     |
| **å¹³è¡Œå…‰** | color      | #1E90FF              | -      | é¢œè‰²     |
|            | intensity  | 1                    | 0-10   | å¼ºåº¦     |
|            | position   | (-1.26, -3.85, 2.98) | -      | ä½ç½®     |
|            | castShadow | true                 | -      | æŠ•å°„é˜´å½± |
|            | helper     | true                 | -      | è¾…åŠ©çº¿   |
| **ç‚¹å…‰æº** | color      | #1E90FF              | -      | é¢œè‰²     |
|            | intensity  | 1                    | 0-10   | å¼ºåº¦     |
|            | distance   | 2.53                 | 0-100  | ç…§å°„è·ç¦» |
|            | position   | (-4.21, -4.1, 2.53)  | -      | ä½ç½®     |
| **èšå…‰ç¯** | color      | #323636              | -      | é¢œè‰²     |
|            | intensity  | 400                  | 0-1000 | å¼ºåº¦     |
|            | angle      | 0.5                  | 0-Ï€/2  | ç…§å°„è§’åº¦ |
|            | penumbra   | 1                    | 0-1    | åŠå½±è¡°å‡ |
|            | distance   | 20                   | 0-100  | ç…§å°„è·ç¦» |
|            | castShadow | true                 | -      | æŠ•å°„é˜´å½± |

### 5. åæœŸæ•ˆæœåŠŸèƒ½

#### 5.1 æ•ˆæœåˆ—è¡¨

```mermaid
graph TB
    A[åæœŸæ•ˆæœç³»ç»Ÿ] --> B[è¾‰å…‰æ•ˆæœ<br/>UnrealBloomPass]
    A --> C[æ¨¡å‹åˆ†è§£<br/>ModelDecompose]
    A --> D[æè´¨æ‹–æ‹½<br/>TransformControls]
    A --> E[è½®å»“é«˜äº®<br/>OutlinePass]
    A --> F[æŠ—é”¯é½¿<br/>FXAA]
    A --> G[è‰²è°ƒæ˜ å°„<br/>ToneMapping]

    B --> B1[é˜ˆå€¼ threshold]
    B --> B2[å¼ºåº¦ strength]
    B --> B3[åŠå¾„ radius]
    B --> B4[è¾‰å…‰é¢œè‰²]

    C --> C1[åœ†å½¢åˆ†è§£]
    C --> C2[è‡ªå®šä¹‰åˆ†è§£]
    C --> C3[TweenåŠ¨ç”»]

    D --> D1[å¹³ç§» translate]
    D --> D2[æ—‹è½¬ rotate]
    D --> D3[ç¼©æ”¾ scale]

    E --> E1[å¯è§è¾¹ç¼˜é¢œè‰²]
    E --> E2[éšè—è¾¹ç¼˜é¢œè‰²]
    E --> E3[è¾¹ç¼˜å¼ºåº¦]
```

### 6. ç€è‰²å™¨ç³»ç»ŸåŠŸèƒ½

#### 6.1 é¢„è®¾ç€è‰²å™¨æ¸…å•

| ç€è‰²å™¨åç§° | ç±»å‹ | ç”¨é€” | uniformå‚æ•° | æ›´æ–°æ–¹å¼ |
| --- | --- | --- | --- | --- |
| **è­¦å‘Šç€è‰²å™¨** | å¹³é¢ | è­¦å‘Šæç¤ºåŒºåŸŸ | uTime, uColor, uSpeed | æ¯å¸§æ›´æ–°uTime |
| **ç½—ç›˜ç€è‰²å™¨** | å¹³é¢ | å¯¼èˆªæŒ‡ç¤º | iTime, iResolution | æ¯å¸§æ›´æ–°iTime |
| **é›·è¾¾ç€è‰²å™¨** | å¹³é¢ | æ‰«ææ•ˆæœ | iTime, iResolution | æ¯å¸§æ›´æ–°iTime |
| **å…‰åœˆç€è‰²å™¨** | å¹³é¢ | æ”¶ç¼©å…‰åœˆæ•ˆæœ | uTime, uColor, uRadius | æ¯å¸§æ›´æ–°uTime |
| **å¢™ä½“ç€è‰²å™¨** | å¹³é¢ | æµåŠ¨å¢™ä½“æ•ˆæœ | uTime | æ¯å¸§æ›´æ–°uTime |
| **é—ªçƒè­¦å‘Š** | å¹³é¢ | é—ªçƒè­¦å‘Šæ•ˆæœ | uTime, uPulse | æ¯å¸§æ›´æ–°uTime |
| **åœ†åœˆå›´æ ** | ç®¡çŠ¶ | å›´æ æ•ˆæœ | uMax, uMin, uColor | ç¼©æ”¾åŠ¨ç”» |

#### 6.2 ç€è‰²å™¨ä¼˜åŒ–ç­–ç•¥

```typescript
/**
 * ç€è‰²å™¨ç¼“å­˜ä¼˜åŒ–
 *
 * åŸæ¶æ„: æ¯å¸§éå†æ•´ä¸ªåœºæ™¯æ›´æ–°ç€è‰²å™¨
 * æ–°æ¶æ„: ä½¿ç”¨Mapç¼“å­˜ï¼Œåªæ›´æ–°æ³¨å†Œçš„ç€è‰²å™¨
 */

// âœ… ä¼˜åŒ–åçš„å®ç°
export function useShaderCache() {
  const cache = new Map<string, ShaderCacheItem>();

  const register = (uuid: string, shader: ShaderMesh) => {
    cache.set(uuid, {
      mesh: shader,
      updateType: getUpdateType(shader.userData.shaderType),
    });
  };

  const updateAll = (clock: THREE.Clock) => {
    for (const [uuid, item] of cache) {
      if (!item.mesh.parent) {
        cache.delete(uuid);
        continue;
      }

      switch (item.updateType) {
        case 'uTime':
          item.mesh.material.uniforms.uTime.value = clock.getElapsedTime();
          break;
        case 'iTime':
          item.mesh.material.uniforms.iTime.value += 0.01;
          break;
        case 'scale':
          updateScaleAnimation(item.mesh);
          break;
      }
    }
  };

  return { register, updateAll, cache };
}
```

---

## ğŸ¯ æ¨¡å—è®¾è®¡è¯¦è§£

### 1. æ ¸å¿ƒComposablesæ¸…å•

#### 1.1 Three.jsæ ¸å¿ƒæ¨¡å— (10ä¸ª)

```typescript
// composables/core/three/
export interface ThreeCoreComposables {
  useThreeScene: () => SceneAPI;
  useThreeRenderer: () => RendererAPI;
  useThreeCamera: () => CameraAPI;
  useThreeControls: () => ControlsAPI;
  useThreeLoader: () => LoaderAPI;
  useThreeRaycaster: () => RaycasterAPI;
  useThreeHelper: () => HelperAPI;
  useThreeMath: () => MathAPI;
  useThreeTraverse: () => TraverseAPI;
  useThreeDispose: () => DisposeAPI;
}
```

#### 1.2 ç¼–è¾‘å™¨åŠŸèƒ½æ¨¡å— (30+ä¸ª)

```typescript
// composables/editor/
export interface EditorComposables {
  // æè´¨ç³»ç»Ÿ (6ä¸ª)
  useMaterialEditor: () => MaterialEditorAPI;
  useMaterialTypes: () => MaterialTypesAPI;
  useMaterialTexture: () => MaterialTextureAPI;
  useMaterialSelection: () => MaterialSelectionAPI;
  useMaterialBatch: () => MaterialBatchAPI;
  useMaterialPresets: () => MaterialPresetsAPI;

  // ç¯å…‰ç³»ç»Ÿ (7ä¸ª)
  useLightEditor: () => LightEditorAPI;
  useAmbientLight: () => AmbientLightAPI;
  useDirectionalLight: () => DirectionalLightAPI;
  usePointLight: () => PointLightAPI;
  useSpotLight: () => SpotLightAPI;
  useLightHelper: () => LightHelperAPI;
  useLightPresets: () => LightPresetsAPI;

  // åŠ¨ç”»ç³»ç»Ÿ (5ä¸ª)
  useAnimationPlayer: () => AnimationPlayerAPI;
  useAnimationMixer: () => AnimationMixerAPI;
  useAnimationClip: () => AnimationClipAPI;
  useModelRotation: () => ModelRotationAPI;
  useAnimationPresets: () => AnimationPresetsAPI;

  // èƒŒæ™¯ç³»ç»Ÿ (7ä¸ª)
  useBackgroundEditor: () => BackgroundEditorAPI;
  useBackgroundColor: () => BackgroundColorAPI;
  useBackgroundImage: () => BackgroundImageAPI;
  useBackgroundPanorama: () => BackgroundPanoramaAPI;
  useBackgroundHDR: () => BackgroundHDRAPI;
  useBackgroundVideo: () => BackgroundVideoAPI;
  useBackgroundPresets: () => BackgroundPresetsAPI;

  // å…¶ä»–ç³»ç»Ÿ...
}
```

#### 1.3 æ‹–æ‹½ç³»ç»Ÿæ¨¡å— (15ä¸ª)

```typescript
// composables/drag/
export interface DragComposables {
  // æ ¸å¿ƒ (4ä¸ª)
  useDragCore: () => DragCoreAPI;
  useDragState: () => DragStateAPI;
  useDragEvents: () => DragEventsAPI;
  useDragLifecycle: () => DragLifecycleAPI;

  // ç±»å‹ (5ä¸ª)
  useModelDrag: () => ModelDragAPI;
  useGeometryDrag: () => GeometryDragAPI;
  useTagDrag: () => TagDragAPI;
  useShaderDrag: () => ShaderDragAPI;
  useLibraryDrag: () => LibraryDragAPI;

  // å·¥å…· (6ä¸ª)
  useDragPosition: () => DragPositionAPI;
  useRaycast: () => RaycastAPI;
  useDragConstraints: () => DragConstraintsAPI;
  useDragValidation: () => DragValidationAPI;
  useDragAnimation: () => DragAnimationAPI;
  useDragSnapshot: () => DragSnapshotAPI;
}
```

---

## ğŸ“Š çŠ¶æ€ç®¡ç†è®¾è®¡

### Pinia Store å®Œæ•´æ¸…å•

#### æ ¸å¿ƒStores (15ä¸ª)

```typescript
// stores/modules/
export interface StoreModules {
  // ç¼–è¾‘å™¨æ ¸å¿ƒ
  editorStore: EditorState;
  sceneStore: SceneState;
  selectionStore: SelectionState;
  historyStore: HistoryState;
  settingsStore: SettingsState;

  // æ‹–æ‹½ç³»ç»Ÿ
  dragStore: DragState;

  // æ¨¡å‹ç®¡ç†
  multiModelStore: MultiModelState;
  geometryStore: GeometryState;

  // åŠŸèƒ½æ¨¡å—
  materialStore: MaterialState;
  lightStore: LightState;
  animationStore: AnimationState;
  backgroundStore: BackgroundState;
  effectStore: EffectState;
  tagStore: TagState;
  shaderStore: ShaderState;
}
```

### Store çŠ¶æ€ç»“æ„ç¤ºä¾‹

```typescript
// stores/modules/editor.ts
export interface EditorState {
  // ç¼–è¾‘å™¨æ¨¡å¼
  mode: EditorMode; // 'edit' | 'preview' | 'multiModel' | 'geometry' | 'tag' | 'shader'

  // åŠ è½½çŠ¶æ€
  loading: boolean;
  loadingProgress: number;

  // é€‰ä¸­å¯¹è±¡
  selectedObject: THREE.Object3D | null;
  selectedMaterial: THREE.Material | null;

  // ç¼–è¾‘å™¨é…ç½®
  config: EditorConfig;

  // UIçŠ¶æ€
  panelVisible: boolean;
  activePanel: PanelType;
  toolbarVisible: boolean;

  // è§†å£çŠ¶æ€
  viewportSize: { width: number; height: number };
  fullscreen: boolean;

  // æ€§èƒ½ç›‘æ§
  fps: number;
  renderTime: number;
}
```

---

## ğŸ¨ ç»„ä»¶è®¾è®¡è§„èŒƒ

### ç»„ä»¶åˆ†ç±»

| åˆ†ç±»          | å‘½åè§„èŒƒ     | èŒè´£         | ç¤ºä¾‹            |
| ------------- | ------------ | ------------ | --------------- |
| **å¸ƒå±€ç»„ä»¶**  | XxxLayout    | é¡µé¢å¸ƒå±€     | `EditorLayout`  |
| **é¡µé¢ç»„ä»¶**  | XxxView      | è·¯ç”±é¡µé¢     | `EditorView`    |
| **ä¸šåŠ¡ç»„ä»¶**  | XxxPanel/Xxx | ä¸šåŠ¡é€»è¾‘     | `MaterialPanel` |
| **é€šç”¨ç»„ä»¶**  | Base/Common  | çº¯å±•ç¤º       | `BaseButton`    |
| **Threeç»„ä»¶** | ThreeXxx     | Three.jså°è£… | `ThreeCanvas`   |

### ç»„ä»¶é€šä¿¡æ–¹å¼

```mermaid
graph TB
    A[ç»„ä»¶é€šä¿¡æ–¹å¼]

    A --> B[Props Down]
    A --> C[Events Up]
    A --> D[Provide/Inject]
    A --> E[Pinia Store]
    A --> F[Composables]

    B --> B1[çˆ¶ä¼ å­æ•°æ®]
    C --> C1[å­ä¼ çˆ¶äº‹ä»¶]
    D --> D1[è·¨å±‚çº§ä¼ é€’]
    E --> E1[å…¨å±€çŠ¶æ€]
    F --> F1[é€»è¾‘å…±äº«]
```

---

## ğŸ“ å®Œæ•´åŠŸèƒ½ç»Ÿè®¡

### åŠŸèƒ½ç‚¹ç»Ÿè®¡è¡¨

| æ¨¡å—           | åŠŸèƒ½ç‚¹æ•°é‡ | Composablesæ•°é‡ | Storesæ•°é‡ | å¤æ‚åº¦     |
| -------------- | ---------- | --------------- | ---------- | ---------- |
| **æ¨¡å‹ç®¡ç†**   | 15         | 8               | 2          | â­â­â­     |
| **æ‹–æ‹½ç³»ç»Ÿ**   | 25         | 15              | 1          | â­â­â­â­â­ |
| **æè´¨ç³»ç»Ÿ**   | 20         | 6               | 1          | â­â­â­â­   |
| **ç¯å…‰ç³»ç»Ÿ**   | 16         | 7               | 1          | â­â­â­     |
| **åŠ¨ç”»ç³»ç»Ÿ**   | 12         | 5               | 1          | â­â­â­     |
| **èƒŒæ™¯ç³»ç»Ÿ**   | 10         | 7               | 1          | â­â­â­     |
| **åæœŸæ•ˆæœ**   | 18         | 6               | 1          | â­â­â­â­â­ |
| **å‡ ä½•ä½“ç³»ç»Ÿ** | 8          | 3               | 1          | â­â­â­     |
| **æ ‡ç­¾ç³»ç»Ÿ**   | 10         | 3               | 1          | â­â­â­â­   |
| **ç€è‰²å™¨ç³»ç»Ÿ** | 14         | 8               | 1          | â­â­â­â­â­ |
| **äº¤äº’ç³»ç»Ÿ**   | 20         | 10              | 2          | â­â­â­â­   |
| **å¯¼å‡ºç³»ç»Ÿ**   | 8          | 6               | 0          | â­â­â­     |
| **åˆè®¡**       | **176**    | **84**          | **13**     | -          |

---

## ğŸ”¥ çƒ­ç‚¹åŠŸèƒ½æ·±åº¦è®¾è®¡

### å°„çº¿æ£€æµ‹ç³»ç»Ÿ

```typescript
// composables/drag/utils/useRaycast.ts
export function useRaycast() {
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  /**
   * è·å–é¼ æ ‡ä½ç½®çš„3Däº¤ç‚¹
   */
  const getIntersection = (
    position: { x: number; y: number },
    scene: THREE.Scene,
    camera: THREE.Camera,
    container?: HTMLElement,
  ): THREE.Intersection | null => {
    const rect = container?.getBoundingClientRect() ?? {
      left: 0,
      top: 0,
      width: window.innerWidth,
      height: window.innerHeight,
    };

    // è½¬æ¢ä¸ºæ ‡å‡†åŒ–è®¾å¤‡åæ ‡
    mouse.x = ((position.x - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((position.y - rect.top) / rect.height) * 2 + 1;

    // å°„çº¿æ£€æµ‹
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(scene.children, true);

    // è¿‡æ»¤æœ‰æ•ˆå¯¹è±¡
    const validIntersects = intersects.filter(
      (item) => item.object.isMesh && item.object.material,
    );

    return validIntersects[0] || null;
  };

  return {
    raycaster,
    mouse,
    getIntersection,
  };
}
```

---

## ğŸ¯ æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†:

- âœ… å®Œæ•´çš„åŠŸèƒ½æ¸…å• (176ä¸ªåŠŸèƒ½ç‚¹)
- âœ… è¯¦ç»†çš„æ¨¡å—è®¾è®¡ (84ä¸ªComposables)
- âœ… å®Œæ•´çš„APIå®šä¹‰
- âœ… ä¼˜åŒ–ç­–ç•¥è¯´æ˜

**é…åˆä¸»æ–‡æ¡£å’Œå…¶ä»–æ–‡æ¡£ä½¿ç”¨ï¼Œå¯ä»¥è·å¾—å®Œæ•´çš„æ¶æ„è§†å›¾ï¼**
